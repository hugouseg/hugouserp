openapi: 3.0.3
info:
  title: HugousERP API v1
  description: REST API for HugousERP system - POS and Inventory Management
  version: 1.0.0
  contact:
    name: API Support
    email: support@hugouserp.com

servers:
  - url: https://erp.example.com/api/v1
    description: Production server
  - url: http://localhost:8000/api/v1
    description: Development server

security:
  - sanctumAuth: []
  - storeToken: []

paths:
  /health:
    get:
      summary: API Health Check
      security: []
      responses:
        '200':
          description: API is running
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  version:
                    type: string
                  timestamp:
                    type: string

  /branches/{branchId}/products/search:
    get:
      summary: Search products for POS
      tags:
        - Products
      security:
        - sanctumAuth: []
      parameters:
        - name: branchId
          in: path
          required: true
          schema:
            type: integer
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 2
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
        - name: category_id
          in: query
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
        - name: per_page
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Products found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ProductSearchResult'
                      current_page:
                        type: integer
                      last_page:
                        type: integer
                      per_page:
                        type: integer
                      total:
                        type: integer

  /branches/{branchId}/pos/checkout:
    post:
      summary: Complete POS sale
      tags:
        - POS
      security:
        - sanctumAuth: []
      parameters:
        - name: branchId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
      responses:
        '201':
          description: Sale completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/SaleResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/stock:
    get:
      summary: Get stock levels
      tags:
        - Inventory
      security:
        - storeToken: []
      parameters:
        - name: sku
          in: query
          schema:
            type: string
        - name: warehouse_id
          in: query
          schema:
            type: integer
        - name: low_stock
          in: query
          schema:
            type: boolean
        - name: per_page
          in: query
          schema:
            type: integer
            maximum: 100
      responses:
        '200':
          description: Stock levels retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/StockLevel'

  /inventory/update-stock:
    post:
      summary: Update stock for a product
      tags:
        - Inventory
      security:
        - storeToken: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStockRequest'
      responses:
        '200':
          description: Stock updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/StockUpdateResponse'

  /internal/diagnostics:
    get:
      summary: System diagnostics
      tags:
        - Internal
      security:
        - sanctumAuth: []
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnosticsResponse'
        '503':
          description: System has errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnosticsResponse'

components:
  securitySchemes:
    sanctumAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    storeToken:
      type: apiKey
      in: header
      name: X-Store-Token

  schemas:
    ProductSearchResult:
      type: object
      properties:
        id:
          type: integer
        product_id:
          type: integer
        name:
          type: string
        label:
          type: string
        sku:
          type: string
        price:
          type: number
          format: float
        sale_price:
          type: number
          format: float
        barcode:
          type: string
          nullable: true
        tax_id:
          type: integer
          nullable: true

    CheckoutRequest:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - product_id
              - qty
            properties:
              product_id:
                type: integer
              qty:
                type: number
                minimum: 0.01
              price:
                type: number
                nullable: true
              discount:
                type: number
                minimum: 0
                maximum: 100
              percent:
                type: boolean
              tax_id:
                type: integer
                nullable: true
        payments:
          type: array
          items:
            type: object
            required:
              - method
              - amount
            properties:
              method:
                type: string
                enum: [cash, card, transfer, cheque]
              amount:
                type: number
                minimum: 0.01
        customer_id:
          type: integer
          nullable: true
        warehouse_id:
          type: integer
          nullable: true
        notes:
          type: string
          maxLength: 1000

    SaleResponse:
      type: object
      properties:
        id:
          type: integer
        code:
          type: string
        grand_total:
          type: number
        paid_total:
          type: number
        due_total:
          type: number
        status:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              product_id:
                type: integer
              product_name:
                type: string
              qty:
                type: number
              unit_price:
                type: number
              discount:
                type: number
              line_total:
                type: number
        payments:
          type: array
          items:
            type: object
            properties:
              method:
                type: string
              amount:
                type: number
              reference_no:
                type: string
        created_at:
          type: string
          format: date-time

    UpdateStockRequest:
      type: object
      required:
        - qty
        - direction
      properties:
        product_id:
          type: integer
        external_id:
          type: string
        qty:
          type: number
        direction:
          type: string
          enum: [in, out, set]
        reason:
          type: string
          maxLength: 255
        warehouse_id:
          type: integer

    StockLevel:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        sku:
          type: string
        min_stock:
          type: number
        branch_id:
          type: integer
        current_quantity:
          type: number

    StockUpdateResponse:
      type: object
      properties:
        product_id:
          type: integer
        sku:
          type: string
        old_quantity:
          type: number
        new_quantity:
          type: number

    DiagnosticsResponse:
      type: object
      properties:
        success:
          type: boolean
        status:
          type: string
          enum: [ok, warning, error]
        timestamp:
          type: string
          format: date-time
        checks:
          type: object
          properties:
            cache:
              $ref: '#/components/schemas/DiagnosticCheck'
            queue:
              $ref: '#/components/schemas/DiagnosticCheck'
            mail:
              $ref: '#/components/schemas/DiagnosticCheck'
            filesystem:
              $ref: '#/components/schemas/DiagnosticCheck'
            database:
              $ref: '#/components/schemas/DiagnosticCheck'

    DiagnosticCheck:
      type: object
      properties:
        status:
          type: string
          enum: [ok, warning, error]
        driver:
          type: string
        message:
          type: string
        warnings:
          type: array
          items:
            type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

tags:
  - name: Products
    description: Product management operations
  - name: POS
    description: Point of Sale operations
  - name: Inventory
    description: Inventory and stock management
  - name: Internal
    description: Internal system operations
